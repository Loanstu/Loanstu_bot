/start

var button = [{ title : "âœ…CHECK" , command : "âœ…CHECK" }]
Bot.sendInlineKeyboard(button , "*ğŸ›¡ Subscribe to our Channel to Start the Bot and Earn from It: \n\nâ¤ @loanstu_updates\n\nâ˜‘ï¸ Done Subscribed! Click âœ…CHECK*")
function hello(message) {
var greetings = ""

Bot.sendMessage(greetings + message)
}

function doTouchOwnLink() {
Bot.sendMessage("*You're Trying to Invite Yourself âŒ*")
}

function doAttracted(channel) {
hello("Referral: " + channel)
}

function doAtractedByUser(refUser) {
hello("")
var balance = Libs.ResourcesLib.anotherUserRes("balance", refUser.telegramid)
balance.add(0.5)
Bot.sendMessageToChatWithId(refUser.chatId, "*ğŸ§ New Referral: +0.5 â‚¹*");
}

function doAlreadyAttracted(){
Bot.sendMessage("*You Already Started the Bot âŒ*");
}

var trackOptions = {
onTouchOwnLink: doTouchOwnLink,
onAttracted: doAttracted,
onAtractedByUser: doAtractedByUser,
onAlreadyAttracted: doAlreadyAttracted
}

Libs.ReferralLib.currentUser.track(trackOptions);

/âœ…CHECK

let stat = Bot.getProperty(""+user.telegramid+"");

if (stat=="ban"){
Bot.sendMessage("*You're Banned From Using the Bot âŒ*");
}else{

let channel = "@loanstu_updates";
let id = user.telegramid
Api.getChatMember({ 
chat_id : channel,
user_id : id,
on_result :"check"})
}

/check

var user = options.result.status;
User.setProperty("status" , user, "string");
if (user=="member" | user =="administrator" | user=="creator"){
Bot.runCommand("main_menu")
User.addToGroup("user")
}

if (user=="left"){
Bot.sendMessage("*âŒ You must join all required channels*")
}

/main_menu

var user = User.getProperty("status");
if (user=="member" | user =="administrator" | user=="creator"){
var balance = Libs.ResourcesLib.userRes("balance");
var withdrawn = Libs.ResourcesLib.userRes("withdrawn");
var ref = Libs.ResourcesLib.userRes("referral");
var msgid = User.getProperty("msgid")
Api.deleteMessage({
message_id : msgid
})
Bot.sendKeyboard("ğŸ’° Balance\nğŸ‘« Referral,ğŸ Bonus,ğŸ’²Withdraw,\nâš™ï¸Set wallet,ğŸ“Support", "*â–¶ï¸ Refer and Earn Cash at LoanStu*")
}
if (user=="left"){
Bot.runCommand("/start");
}

/ğŸ Bonus

function canRun(){
var last_run_at = User.getProperty("last_run_at");
if(!last_run_at){ return true }

var minutes = (Date.now() - last_run_at) /1000/60;

var minutes_in_day = 12 * 60
var next = minutes_in_day - minutes
var wait_hours = Math.floor(next / 60)
next -= wait_hours * 60
var wait_minutes = Math.floor(next)
var seconds = Math.floor((next - wait_minutes) * 60)
if (minutes < minutes_in_day) {
Bot.sendMessage("*ğŸ“› You have already received a bonus today\n\nâ–¶ï¸ Come Back After â³ "+wait_hours+" h "+wait_minutes+" m " 
+ seconds+ " s*" );
return
}
return true;
}

if(!canRun()){ return }
User.setProperty("last_run_at", Date.now(), "integer");

let balance = Libs.ResourcesLib.userRes("balance")
balance.add(0.25)
Bot.sendMessage(
"*ğŸ Congrats, you received 0.25 â‚¹*"
)

/auto

Please wait for an answer.

var withdrawn = Bot.getProperty("totalWithdrawn");
withdrawn = parseFloat(withdrawn); 
var wallet = User.getProperty("PaytmWallet");
var balance = Libs.ResourcesLib.userRes("balance")
if(data.message < 20 ){
Bot.sendMessage("_âŒ Minimum withdraw is 20 â‚¹_")
}else{
if(data.message > balance.value()){
Bot.sendMessage("_âŒ Maximum withdraw is "+balance.value().toFixed(6)+" â‚¹_")
}else{
Bot.sendMessage("*âœ… Withdrawal sent\n\nğŸ’³ Transaction Details:\n ğŸ’°Amount: "+data.message+" â‚¹\nğŸ’¼ Wallet: "+wallet+"\n\nâ›”ï¸ It may take up to 24 hours*")
balance.add(-data.message)
Api.sendMessage({ 
chat_id: "@loanstu_updates", 
text: "*ğŸ”‹ New Approved Payout\n\nâ–ªï¸ Status: Confirmed\nâ–ªï¸ User Id: *"+user.telegramid+"\n*â–ªï¸ Amount: *"+data.message+" â‚¹\n\n*â™¦ï¸ Paid Address â™¦ï¸\n "+wallet+"\n\nâœ… Bot @bot*" , 
parse_mode: "Markdown"})
}
}

/ğŸ’²Withdraw

let stat = Bot.getProperty(""+user.telegramid+"")
let wdinfo = Bot.getProperty("wdInfo")
if (stat=="ban"){
Bot.sendMessage("*You're Banned*")
}else{
let balance = Libs.ResourcesLib.userRes("balance")
let withdrawn = Libs.ResourcesLib.userRes("withdrawn")
var wallet = User.getProperty("PaytmWallet")
if(wallet == undefined){
Bot.sendMessage("_âŒ Wallet not set_")
}else{
if (balance.value() < 20){
Bot.sendMessage("_âŒ You need at least 20 â‚¹ to withdraw !_")
}else{
Bot.sendMessage("*ğŸ“¤ Enter Amount in â‚¹*")
Bot.runCommand("auto")
}
}
}

/âš™ï¸Set wallet

let wallet = User.getProperty("PaytmWallet")
User.setProperty("PaytmWallet" , data.message ,"string")
Bot.sendMessage("âœ… Paytm wallet address set to: *"+data.message+"*")

/Ask

let Ask = User.getProperty("Ask")
User.setProperty("Ask" , data.message ,"string")
Bot.sendMessage("*ğŸ“© Message sent to admin as: *"+data.message+"")

/ğŸ’° Balance

var balance = Libs.ResourcesLib.userRes("balance")
var lib = Libs.ReferralLib
var refList = lib.currentUser.refList.get();
Bot.sendMessage("*ğŸ¤´ User: "+user.first_name+"\n\nğŸ’° Balance: "+balance.value().toFixed(2)+" â‚¹\n\nâšœï¸ Refer and Earn More at LoanStu*")

/ğŸ‘« Referral

let stat = Bot.getProperty(""+user.telegramid+"");

if (stat=="ban"){
Bot.sendMessage("*You're Banned*");
}else{

let res = Libs.ResourcesLib.userRes("referral");
let reflink=Libs.ReferralLib.currentUser.getRefLink("LoanStu_Refer_Earn_bot","Bot");
let lib = Libs.ReferralLib
var refList = lib.currentUser.refList.get();
Bot.sendMessage("*â¯ï¸ Total Invites: "+refList.length+" Users\n\nâ›”ï¸ Per Referral: 0.5 â‚¹\n\nğŸ”— Referral Link â¬‡ï¸\n"+reflink+"*");

}

/ğŸ“Support

let Ask = User.getProperty("Ask")
var button = [{ title : "âœï¸Write me" , command : "Ask" }]
Bot.sendInlineKeyboard(button , "*ğŸ“« Last Question: *"+Ask+"")
